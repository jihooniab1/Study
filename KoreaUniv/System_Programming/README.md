# COSE-322
https://os.korea.ac.kr/

# Index
- [1. Lecture 1](#lecture-1)

# Lecture 1
## File
운영체제에서 **파일** 은 저장장치를 사용자에게 쉽게 보여주기 위한 **추상화** 된 개념입니다. 운영체제에서 `File as abstraction`은 **바이트 들의 선형 배열(Linear array of bytes)** 로 정의 됩니다. 
- 선형적(Linear)은 파일 데이터가 1차원 구조로 i, i+1, i+2와 같이 순차적으로 배치되는 것을 의미합니다. 
- 배열(array)은 데이터 공간이 비어있지 않고 연속적(not sparse)이라는 것으로 프로세스의 주소 공간은 sparse 할 수 있다는 점과 차이가 있습니다.
- 파일 내에서 데이터에 접근하는 최소 단위는 **byte** 단위입니다. 물리 메모리가 `word-aligned` 되어 있더라도 파일 시스템은 바이트 단위의 접근을 보장합니다. 

파일은 주소 공간(address space)과 비교했을 때, 파일의 경우 길이가 가변적이고, 비휘발성(persistent)이며 데이터가 연속적이라는 특징이 있습니다. 반면 프로세스의 주소 공간은 길이가 고정(Fixed)되어 있으며 휘발성(Volatile)이고 비연속적일 수 있다는 차이가 있습니다. 파일과 주소 공간 모두 **프로세스 간 공유** 가 가능하다는 공통점이 있습니다.

데이터베이스에서는 failure semantics라는게 확실하게 정의되어 있음. 뭐라도 중간에 하다가 실패하면 원위치로 돌아가기(트랜잭션). 파일 시스템은 **failure semantics** 가 정의되어 있지 않음. ext4 같은 파일 시스템에서 `저널링`이라는 걸로 부분적인 보완을 하지만 DB 수준까지는 아님. 

File로 DB를 만들면 어떻게 될까? => 파일로 DB를 만들 수는 있으나 트랜잭션을 정확히 수행못할 수 있다는 단점이 있습니다.

파일 시스템은 크게 두가지 의미를 갖는데, 하나는 파일과 물리디스크 블록 간의 **mapping** 을 의미합니다. 파일 시스템은 디스크 위치 배치를 관리하고, 사용자는 스토리지의 종류나 파일이 저장된 위치를 알 필요 없습니다(**location independence**). 파일 블록 넘버가 1, 2, 3이런 파일들이 디스크 블록 번호는 108, 3010, 3011과 같은 경우를 의미합니다.

다른 하나는 디스크에 들어가 있는 파일 전체를 총칭하는 것으로 파일 시스템에 따라 파일들의 배치나 구성이 달라집니다. 프로세스와 파일 시스템간의 관계는 아래와 같이 나타낼 수 있습니다. 프로세스는 파일을 사용하는 주체로 읽기, 쓰기 작업을 수행하고, 메모리는 프로세스가 직접 접근하여 작업하는 공간입니다. 프로세스가 파일 데이터를 메모리에 적재합니다. 파일 시스템은 **파일 객체** 와 **버퍼 캐시** 로 구성되며 파일 객체는 프로세스가 접근하는 추성화된 인터페이스, 버퍼 캐시는 `디스크 I/O`를 줄이기 위한 성능 향상 메커니즘입니다.그리고 Physical Storage는 실제 데이터가 저장되는 하드웨어입니다.  <br>

![image](./images/Lec1_1.png) <br>

### 프로세스가 Read 연산 실행
프로세스가 `read` 시스템 콜을 호출하면 파일 시스템은 먼저 **Buffer Cache** 를 확인합니다. 만약 `cache hit`라면 캐시에서 바로 메모리로 복사를 하고, `cache miss`라면 Physical Storage에서 데이터를 읽어온 다음 캐시에 저장하고, 이를 메모리로 복사합니다. 이를 통해 데이터가 프로세스의 메모리 공간으로 복사됩니다. 

### 프로세스가 Write 연산 실행
프로세스가 `write` 시스템 콜을 호출하면 데이터가 먼저 **Buffer Cache** 에 기록된 후 나중에 Physical Storage에 기록이 됩니다. 

디스크 속도는 굉장히 느리기 때문에 **page cache** 와 비슷한 느낌으로 자주 사용되는 데이터를 메모리에 유지한다고 보면 될 것 같습니다.

파일에는 **메타데이터(Metadata)** 라 불리는 파일의 속성을 저장하는 필드가 있습니다. 파일의 메타데이터에는 다음과 같은 값들이 있습니다. <br>

![lec1_2](./images/Lec1_2.png) <br>

기타 메타데이터로는 Time, date, user id (uid), Directory 정보 등이 있습니다.

그리고 리눅스 커널에서는 **inode** 라는 자료구조에서 이러한 메타데이터를 저장합니다. 그리고 inode는 디스크에 저장되어 `Persistence`를 제공합니다. 

이런 메타데이터도 **caching** 을 하는데, 메타데이터에 접근하고, 거기서 데이터 위치를 읽어 데이터에 접근하면 여러 번의 디스크 접근을 필요로 하기에 성능 문제 발생할 수 있기 때문입니다. 